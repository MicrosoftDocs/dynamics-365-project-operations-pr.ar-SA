---
title: الفوترة في Project Service Automation
description: يقدم هذا الموضوع معلومات حول الفوترة.
author: rumant
manager: kfend
ms.custom:
- dyn365-projectservice
ms.date: 08/03/2020
ms.topic: article
ms.service: business-applications
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365PS
- ProjectOperations
ms.openlocfilehash: f8107a660f9993c7b6a32d69047a81fb7e0abef8
ms.sourcegitcommit: 5c4c9bf3ba018562d6cb3443c01d550489c415fa
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 10/16/2020
ms.locfileid: "4070708"
---
# <a name="invoicing-in-project-service-automation"></a>الفوترة في Project Service Automation

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

تفيد الفوترة في Dynamics 365 Project Service Automation لأنها تعطي لمديري المشروع المستوى الثاني من الموافقة قبل قيامهم بإنشاء الفواتير للعملاء. يتم استكمال المستوى الأول من الموافقة عند اعتماد إدخالات الوقت والمصروفات التي يرسلها أعضاء فريق المشروع.

لم يتم تصميم PSA لإنشاء فواتير موجهة للعملاء، وذلك للأسباب التالية:

- ولا يحتوي على معلومات الضريبة.
- ولا يمكنه تحويل العملات الأخرى إلى عملة الفوترة باستخدام أسعار صرف مكونة بشكل صحيح.
- ولا يمكنه تنسيق الفواتير بشكل صحيح حتى يمكن طباعتها.

وبدلا من ذلك، يمكنك استخدام نظام مالي أو محاسبي لإنشاء فواتير موجهة للعميل تستخدم المعلومات اقتراحات الفواتير التي تم إنشائها في PSA.

## <a name="creating-project-invoices-in-psa"></a>إنشاء فواتير المشروع في PSA

يمكن إنشاء فواتير المشروع بمعدل واحدة في المرة أو بشكل مجمع. ويمكنك إنشاؤها يدويا، أو يمكن تكوينها بحيث يتم إنشاؤها في عمليات التشغيل التلقائي.

### <a name="manually-create-project-invoices-in-psa"></a>إنشاء فواتير المشروع يدويًا في PSA

من صفحة قائمة **عقود المشروع** ، يمكنك إنشاء فواتير المشروع بشكل منفصل لكل عقد مشروع، أو يمكنك إنشاء فواتير بشكل مجمع لعقود المشروعات المتعددة.

اتبع هذه الخطوة لإنشاء فاتورة لعقد مشروع محدد.

- في صفحة قائمة **عقود المشروع** ، افتح عقد مشروع، ثم قم بتحديد **إنشاء فاتورة**.

    ![إنشاء فواتير مشروع لعقد مشروع محدد](media/CreateProjectInvoicesOneByOne.png)

    يتم إنشاء فاتورة لكافة الحركات الخاصة بعقد المشروع المحدد والتي تكون حالتها **جاهز للفوترة**. تتضمن هذه الحركات الوقت والمصروفات والأحداث الرئيسية وبنود العقد التي تستند إلى منتج.

اتبع هذه الخطوات لإنشاء فواتير بشكل مجمع.

1. في صفحة قائمة **عقود المشروع** ، حدد واحدًا أو أكثر من عقود المشروعات التي يجب عليك إنشاء فاتورة لها ثم قم بتحديد **إنشاء فواتير مشروع**.

    ![إنشاء فواتير المشروع بشكل مجمع](media/CreateProjectInvoicesBulk.png)

    تخبرك رسالة تحذير بأنه قد يكون هناك تأخير قبل إنشاء الفواتير. يتم أيضًا عرض العملية.

2. حدد **موافق** لإغلاق مربع الرسالة.

    يتم إنشاء فاتورة لكافة الحركات الخاصة بشرط التعاقد الذي يكون حالته **جاهز للفوترة**. تتضمن هذه الحركات الوقت والمصروفات والأحداث الرئيسية وبنود العقد التي تستند إلى منتج.

3. لعرض الفواتير التي تم إنشاؤها، انتقل إلى **المبيعات** \> **الفوترة** \> **الفواتير**. ستظهر لك فاتورة واحده لكل عقد مشروع.

### <a name="set-up-automated-creation-of-project-invoices-in-psa"></a>إعداد الإنشاء التلقائي لفواتير المشروع في PSA

اتبع هذه الخطوات لتكوين تشغيل فاتورة مؤتمتة في PSA.

1. انتقل إلى **Project Service** \> **الإعدادات** \> **الوظائف الدفعية**.
2. قم بإنشاء وظيفة دفعية، وقم بتسميتها **إنشاء فواتير PSA**. يجب أن يتضمن اسم الوظيفة الدفعية مصطلح "إنشاء الفواتير."
3. في حقل **نوع الوظيفة** ، حدد **بلا**. افتراضيًا، يتم تعيين  خيارات **التكرار اليومي** و **نشط** إلى **نعم**.
4. حدد **تشغيل سير العمل**. في مربع حوار **البحث عن سجل** ، ستري ثلاث مهام لسير العمل:

    - ProcessRunCaller
    - ProcessRunner
    - UpdateRoleUtilization

5. حدد **ProcessRunCaller** ، ثم حدد **إضافة**.
6. في مربع الحوار التالي، حدد **موافق**. يكون سير عمل **السكون** متبوعًا بسير عمل **العملية**.

    يمكنك أيضا تحديد **ProcessRunner** في الخطوة 5. بعد ذلك، عندما تحدد **موافق** ، يكون سير عمل **العملية** متبوعًا بسير عمل **السكون**.

يؤدي سير عمل **ProcessRunCaller** و **ProcessRunner** إلى إنشاء الفواتير. **ProcessRunCaller** يستدعي **ProcessRunner**. **ProcessRunner** هو سير العمل الذي ينشئ الفواتير فعليًا. ويمر بكافة بنود العقد التي يجب إنشاء الفواتير لها، ويقوم بإنشاء الفواتير لهذه البنود. لتحديد شروط التعاقد التي يجب إنشاء الفواتير لها، فإن الوظيفة تبحث عن تواريخ تشغيل الفاتورة لشروط التعاقد. إذا كانت بنود العقد التي تنتمي لأحد العقود لها نفس تاريخ تشغيل الفاتورة، سيتم تجميع الحركات في فاتورة واحدة بها بندين للفاتورة. إذا لم تكن هناك حركات لإنشاء فواتير لها، تتخطى الوظيفة إنشاء الفاتورة.

بعد انتهاء تشغيل **ProcessRunner** ، فإنه يستدعي **ProcessRunCaller** ، الذي يوفر وقت النهاية، وويتم إغلاقه. بعد ذلك يبدأ **ProcessRunCaller** المؤقت الذي يعمل على مدار 24 ساعة من وقت النهاية المحدد. في نهاية المؤقت، يتم إغلاق **ProcessRunCaller**.

تعتبر وظيفة المعالجة الدفعية لإنشاء الفواتير وظيفة متكررة. إذا تم تشغيل هذه المعالجة الدفعية عده مرات، سيتم إنشاء مثيلات متعددة للوظيفة وتتسبب في حدوث أخطاء. بالتالي، يجب عليك بدء عملية المعالجة الدفعية مرة واحدة فقط، وينبغي إعادة تشغيلها في حالة توقفها عن العمل فقط.

> [!NOTE]
> يتم تشغيل فواتير الدفعات في Project Service Automation فقط لبنود عقود المشروع التي تم تكوينها بواسطة جداول الفواتير. يجب أن يحتوي بند العقد مع طريقة فوترة بسعر ثابت على مراحل مكوّنة. سيحتاج بند عقد المشروع مع طريقة فوترة الوقت والمواد إلى إعداد جدول فاتورة يستند إلى التاريخ. يتم توفير معلومات حول إعداد تكرارات الفواتير في سياق مشروع يستند إلى بند عرض أسعار، في الموضوع، [عروض الأسعار وبنود عروض الأسعار](basic-quote-lines.md#invoice-schedule). ينطبق الأمر نفسه على بند العقد المستند إلى المشروع.      
 
### <a name="edit-a-draft-psa-invoice"></a>تحرير مسودة فاتورة PSA

عند إنشاء مسودة فاتورة مشروع، يتم سحب كافة حركات المبيعات غير المفوترة التي تم إنشاؤها عند الموافقة على إدخالات الوقت والمصروفات إلى الفاتورة. يمكنك إجراء عمليات الضبط التالية في حينما تكون الفاتورة لا تزال في مرحله مسودة:

- قم بحذف تفاصيل بند الفاتورة أو تحريرها.
- قم بتحرير الكمية ونوع الفوترة وتعديلها.
- قم بإضافة الوقت والمصروفات والرسوم مباشرة كحركات على الفاتورة. يمكنك استخدام هذه الميزة في حالة تعيين بند الفاتورة إلى شرط التعاقد الذي يسمح بفئات الحركات هذه.

حدد **تأكيد** لتأكيد الفاتورة. إجراء التأكيد هو إجراء أحادي الاتجاه. عندما تحدد **تأكيد** ، فإن النظام يجعل الفاتورة للقراءة فقط ويقوم بإنشاء القيم الفعلية للمبيعات الفعلية التي تمت فوترتها من كل تفصيلة بند فاتورة لكل بند فاتورة. وإذا كانت تفاصيل بند الفاتورة تشير إلى قيمة فعلية لمبيعات غير مفوترة، سيقوم النظام أيضا بإلغاء القيمة الفعلية للمبيعات غير المفوترة. (ستشير أي تفاصيل بند فاتورة تم إنشاؤها من إدخال الوقت أو المصروفات إلى القيمة الفعلية للمبيعات غير المفوترة.) يمكن لأنظمة تكامل دفتر الأستاذ العام استخدام هذا الإلغاء لإلغاء عمل المشروع قيد التقدم (WIP) لأغراض محاسبيه.

### <a name="correct-a-confirmed-psa-invoice"></a>تصحيح فاتورة PSA المؤكدة

يمكن تحرير فواتير PSA المؤكدة (التي تم تصحيحها). عندما تقوم بتصحيح فاتورة مؤكدة، يتم إنشاء مسودة فاتورة تصحيحية جديدة. ونظرا لأن الافتراض هو أنك تريد إلغاء كافة الحركات والكميات من الفاتورة الأصلية، فان هذه الفاتورة التصحيحية تتضمن كافة الحركات من الفاتورة الاصلية، وكافة الكميات الموجودة بها هي 0 (صفر).

إذا كانت أي حركات لا تتطلب التصحيح، فيمكنك إزالتها من مسودة الفاتورة التصحيحية. إذا كنت ترغب في إلغاء أو إرجاع كمية جزئيه فقط، فيمكنك تحرير حقل **الكمية** في تفاصيل البند. إذا قمت بفتح تفاصيل بند الفاتورة، فيمكنك الاطلاع على كمية الفاتورة الأصلية. يمكنك بعد ذلك تحرير كمية الفاتورة الحالية حتى تكون أقل من أو أكبر من كمية الفاتورة الأصلية.

عندم تقوم بتأكيد فاتورة تصحيحية، يتم إلغاء القيمة الفعلية للمبيعات المفوترة الأصلية، وإنشاء القيمة الفعلية للمبيعات المفوترة الجديدة. إذا تم تخفيض الكمية، سيتسبب الفرق في إنشاء قمة فعلية لمبيعات غير مفوترة جديدة أيضًا. علي سبيل المثال، إذا كانت المبيعات الأصلية التي تمت فوترتها لمده ثمان ساعات، وكانت تفاصيل بند الفاتورة التصحيحية تحتوي على كمية مخفضة إلى ست ساعات، فان PSA سيقوم بإلغاء بند المبيعات المفوتر الأصلي وإنشاء قيمتين فعليتين جديدتين:

- قيمة فعلية لمبيعات تمت فوترتها لست ساعات.
- قيمة فعلية لمبيعات غير مفوترة للساعتين المتبقيتين. ويمكن أن يتم فوترة هذه الحركة لاحقا أو وضع علامة عليها على أنها غير خاضعة للرسوم، وذلك وفقا لعمليات التفاوض مع العميل.
